<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data dari Google Sheet API</title>
	<!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Feather Icons for hamburger menu -->
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
      body { font-family: 'Inter', sans-serif; margin: 2rem; background-color: #f9fafb; color: #111827; }
      h1 { color: #1f2937; text-align: center; }
      /* Style untuk header dan tombol navigasi */
      #header-container { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem; }
      .nav-button { padding: 0.6rem 1.2rem; background-color: #16a34a; color: white; text-decoration: none; border-radius: 0.375rem; font-weight: 600; }
      .nav-button:hover { background-color: #15803d; }
      #filter-container { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; justify-content: center; background-color: #fff; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; }
      #filter-container label { font-weight: 600; color: #374151; }
      #filter-container input { padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; }
      #filter-container button { padding: 0.6rem 1.2rem; border: none; border-radius: 0.375rem; color: white; cursor: pointer; font-weight: 600; }
      #filter-button { background-color: #2563eb; }
      #filter-button:hover { background-color: #1d4ed8; }
      #reset-button { background-color: #6b7280; }
      #reset-button:hover { background-color: #4b5563; }
      #table-container { overflow-x: auto; }
      table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); background-color: white; }
      th, td { border: 1px solid #e5e7eb; padding: 0.75rem 1rem; text-align: left; }
      thead { background-color: #f3f4f6; }
      th { font-weight: 600; color: #374151; }
      tbody tr:nth-child(even) { background-color: #f9fafb; }
      #status { text-align: center; font-size: 1.1rem; color: #6b7280; padding: 2rem; }

      #total-container {
        display: flex;
        gap: 1.5rem;
        margin-top: 1.5rem;
        justify-content: flex-end;
      }
      .summary-box {
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        text-align: center;
      }
      .summary-box h3 {
        margin: 0 0 0.25rem 0;
        font-size: 0.9rem;
        font-weight: 600;
      }
      .summary-box p {
        margin: 0;
        font-size: 1.75rem;
        font-weight: 600;
      }
      .total-harga-box {
        background-color: #eef2ff;
        border: 1px solid #c7d2fe;
      }
      .total-harga-box h3 { color: #4f46e5; }
      .total-harga-box p { color: #312e81; }
      .total-jumlah-box {
        background-color: #f0fdf4;
        border: 1px solid #bbf7d0;
      }
      .total-jumlah-box h3 { color: #166534; }
      .total-jumlah-box p { color: #15803d; }

      /* PERUBAHAN: Style untuk summary container dan box */
      #total-container {
        display: flex;
        gap: 1.5rem;
        margin-top: 1.5rem;
        justify-content: flex-end;
      }
      .summary-box {
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        text-align: center;
      }
      .summary-box h3 {
        margin: 0 0 0.25rem 0;
        font-size: 0.9rem;
        font-weight: 600;
      }
      .summary-box p {
        margin: 0;
        font-size: 1.75rem;
        font-weight: 600;
      }
      .total-harga-box {
        background-color: #eef2ff;
        border: 1px solid #c7d2fe;
      }
      .total-harga-box h3 { color: #4f46e5; }
      .total-harga-box p { color: #312e81; }
      .total-jumlah-box {
        background-color: #f0fdf4;
        border: 1px solid #bbf7d0;
      }
      .total-jumlah-box h3 { color: #166534; }
      .total-jumlah-box p { color: #15803d; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">
	<!-- =========== Navbar =========== -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo atau Brand -->
                <div class="text-2xl font-bold text-indigo-600">
                    <a href="./index.html">Hello, Dani <i class="fa-brands fa-gratipay"></i>
                    </a>
                </div>

                <!-- Menu untuk Desktop -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="./index.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">Beranda</a>
                    <a href="./form.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">Form Pengeluaran</a>
                    <a href="./laporan.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">Report</a>
                    <a href="./display_all_data.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">Display</a>
                    <a href="./tentang.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">Tentang</a>
                    <!-- <a href="#" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300">Daftar</a> -->
                </div>

                <!-- Tombol Hamburger untuk Mobile -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-600 hover:text-indigo-600 focus:outline-none">
                        <i data-feather="menu" class="h-6 w-6"></i>
                    </button>
                </div>
            </div>

            <!-- Menu untuk Mobile (disembunyikan secara default) -->
            <div id="mobile-menu" class="hidden md:hidden mt-4">
                <a href="./index.html" class="block py-2 px-4 text-sm text-gray-600 hover:bg-indigo-50 rounded-md">Beranda</a>
                <a href="./form.html" class="block py-2 px-4 text-sm text-gray-600 hover:bg-indigo-50 rounded-md">Form Pengeluaran</a>
                <a href="./laporan.html" class="block py-2 px-4 text-sm text-gray-600 hover:bg-indigo-50 rounded-md">Report</a>
                <a href="./display_all_data.html" class="block py-2 px-4 text-sm text-gray-600 hover:bg-indigo-50 rounded-md">Display Data</a>
                <a href="./tentang.html" class="block py-2 px-4 text-sm text-gray-600 hover:bg-indigo-50 rounded-md">Tentang</a>
            </div>
        </nav>
    </header>
	<!-- =========== Content =========== -->
    <main class="flex-grow container mx-auto px-2 py-12">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-12xl mx-auto">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 text-center">List Data Pengeluaran</h1>
            <p class="text-gray-600 mb-6 text-center">What I Do: Creating, Developing, Beautifying, and Troubleshooting Websites.</p>
			<!-- FORM UNTUK FILTER -->
			<div id="filter-container">
				<label for="startDate">Tanggal Mulai:</label>
				<input type="date" id="startDate">
				<label for="endDate">Tanggal Selesai:</label>
				<input type="date" id="endDate">
				<label for="createdBy">Dibuat Oleh:</label>
				<input type="text" id="createdBy" placeholder="Nama pembuat...">
				<button id="filter-button">Filter</button>
				<button id="reset-button">Reset</button>
			</div>
			<!-- PERUBAHAN: Wadah baru untuk menampilkan total -->
			<div id="total-container"></div>
			<div id="status">Memuat data dari server...</div>
			<div id="table-container"></div>
			
		</div>
	</main>
    
    <!-- =========== Footer =========== -->
    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-sm text-gray-400">&copy; 2025 DaniHartanto. Semua Hak Cipta Dilindungi.</p>
                <div class="flex mt-4 md:mt-0 space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300">
                        <i data-feather="facebook" class="h-5 w-5"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300">
                        <i data-feather="twitter" class="h-5 w-5"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-300">
                        <i data-feather="instagram" class="h-5 w-5"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    

    <script>
        // !!! PENTING: GANTI URL DI BAWAH INI DENGAN URL WEB APP ANDA !!!
        const API_URL = "https://script.google.com/macros/s/AKfycbz68Tie0l1W6ZC4UYVE_z0xV3V212lwWnMyyNdNmjE5lQH_ePrrKvmrtVOgiB0aDV8/exec";
// Referensi ke elemen-elemen UI
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const createdByInput = document.getElementById('createdBy');
        const filterButton = document.getElementById('filter-button');
        const resetButton = document.getElementById('reset-button');
        const statusDiv = document.getElementById('status');
        const tableContainer = document.getElementById('table-container');
        // PERUBAHAN: Referensi ke total container
        const totalContainer = document.getElementById('total-container');

        // Fungsi untuk mengambil data berdasarkan filter saat ini
        function fetchAndDisplayData() {
            statusDiv.style.display = 'block';
            statusDiv.textContent = 'Memuat data...';
            tableContainer.innerHTML = ''; // Kosongkan tabel lama
            totalContainer.innerHTML = ''; // Kosongkan total lama

            const params = new URLSearchParams();
            if (startDateInput.value) params.append('startDate', startDateInput.value);
            if (endDateInput.value) params.append('endDate', endDateInput.value);
            if (createdByInput.value) params.append('createdBy', createdByInput.value.trim());
            
            const fullUrl = `${API_URL}?${params.toString()}`;

            fetch(fullUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => buildTable(data))
                .catch(error => showError(error));
        }

        function buildTable(data) {
            if (data.error) {
                showError({ message: data.error });
                return;
            }
            if (!data || data.length === 0) {
                statusDiv.textContent = 'Tidak ada data yang cocok dengan filter Anda.';
                return;
            }

            statusDiv.style.display = 'none';

            const headers = Object.keys(data[0]);
            let table = '<table><thead><tr>';
            headers.forEach(header => { table += `<th>${header}</th>`; });
            table += '</tr></thead><tbody>';

            data.forEach(row => {
                table += '<tr>';
                headers.forEach(header => { table += `<td>${row[header]}</td>`; });
                table += '</tr>';
            });

            table += '</tbody></table>';
            tableContainer.innerHTML = table;

            // --- PERUBAHAN DIMULAI DI SINI: Kalkulasi Total ---
            let totalHarga = 0;
            let totalJumlah = 0;
            
            // Cari nama header yang sebenarnya (dengan casing aslinya)
            const hargaHeader = headers.find(h => h.toLowerCase() === 'harga');
            const jumlahHeader = headers.find(h => h.toLowerCase() === 'jumlah');
            
            data.forEach(row => {
                if (hargaHeader) {
                    const harga = parseFloat(String(row[hargaHeader]).replace(/[^0-9,-]+/g, ""));
                    if (!isNaN(harga)) totalHarga += harga;
                }
                if (jumlahHeader) {
                    const jumlah = parseInt(String(row[jumlahHeader]).replace(/[^0-9]+/g, ""), 10);
                    if (!isNaN(jumlah)) totalJumlah += jumlah;
                }
            });

            const formattedTotalHarga = new Intl.NumberFormat('id-ID', { 
                style: 'currency', 
                currency: 'IDR',
                minimumFractionDigits: 0 
            }).format(totalHarga);
            
            const formattedTotalJumlah = new Intl.NumberFormat('id-ID').format(totalJumlah);

            let summaryHtml = '';
            if (jumlahHeader) {
                summaryHtml += `
                  <div class="summary-box total-jumlah-box">
                    <h3>Total Jumlah Item</h3>
                    <p>${formattedTotalJumlah}</p>
                  </div>
                `;
            }
            if (hargaHeader) {
                summaryHtml += `
                  <div class="summary-box total-harga-box">
                    <h3>Total Pengeluaran</h3>
                    <p>${formattedTotalHarga}</p>
                  </div>
                `;
            }
            totalContainer.innerHTML = summaryHtml;
            // --- AKHIR PERUBAHAN ---
        }

        function showError(error) {
            statusDiv.textContent = `Gagal memuat data: ${error.message}`;
            statusDiv.style.color = 'red';
            totalContainer.innerHTML = ''; // Sembunyikan total jika error
        }

        // Event Listeners
        filterButton.addEventListener('click', fetchAndDisplayData);
        resetButton.addEventListener('click', () => {
            startDateInput.value = '';
            endDateInput.value = '';
            createdByInput.value = '';
            fetchAndDisplayData();
        });

        // Memuat data awal saat halaman pertama kali dibuka
        document.addEventListener('DOMContentLoaded', fetchAndDisplayData);
    </script>

</body>
</html>
